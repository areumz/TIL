네트워크 통신
=============
* 자바스크립트를 이용해서 웹브라우저의 통신 기능을 사용하는 방법을 알아본다.
* 이 중에서 서버와 클라이언트 간의 데이터를 주고 받는 형식으로서 JSON과 페이지 리로드 없이 웹페이지의 내용을 변경할 수 있는 Ajax는   
웹에플리케이션을 구축하는데 중요한 내용이기 때문에 주의해서 학습할 것!
* 개인적으로 이해하기 조금 어려운 주제 ㅜㅜ!

# Ajax
* 웹브라우저 : 대단히 정적인 시스템. 내용이 바뀌면 페이지 새로고침을 해서 내용을 새롭게 변경해야 했다
* 이것은 웹이 전자 문서를 염두에 두고 고안된 시스템이기 때문에 당연하게 생각 되었다
* 그러다 Ajax 개념이 도입되면서 모든 것이 바뀌었다. Ajax는 웹브라우저와 웹서버가 내부적으로 데이터 통신을 하게 된다.   
그리고 변경된 결과를 웹페이지에 프로그래밍적으로 반영함으로써 웹페이지의 로딩 없이 서비스를 사용할 수 있게 한다
* 예를 들면, 맨 처음 페이지 로딩시에는 없었지만 '내 카테고리' 같은 것에 마우스를 갖다대면 목록이 아래에 뜨는 방식

* Ajax : Asynchronous JavaScript and XML
  * 한국어로는 비동기적 자바스크립트와 XML 정도로 직역할 수 있는데 자바스크립트를 이용해서 비동기적으로 서버와 브라우저가 데이터를 주고 받는 방식을 의미
  * 이 때 사용하는 API가 XMLHttpRequest
  * 그렇다고 꼭 XML을 사용해서 통신해야 하는 것은 아니다. 사실 XML 보다는 JSON을 더 많이 사용
  * 참고) IE5,6 에서는 XMLHttpRequest 객체 대신 ActiveXObject("Msxml2.XMLHTTP.6.0")을 사용해야 한다

# XMLHttpRequest
* 본 예제를 실행하기 위해서는 서버 환경이 구축 되어 있어야 함
## time.php
* 아래 코드는 현재 시간을 출력

```
<?php
$d1 = new DateTime;
$d1->setTimezone(new DateTimezone("asia/seoul"));
echo $d1->format('H:i:s');
?>
```
## demo1.html
* 아래 코드는 time.php에 접속해서 현재 시간은 페이지에 표시
```
<p>time : <span id="time"></span></p>
<input type="button" id="execute" value="execute" />
<script>
document.querySelector('input').addEventListener('click', function(event){
    var xhr = new XMLHttpRequest();
    xhr.open('GET', './time.php');
    xhr.onreadystatechange = function(){
        if(xhr.readyState === 4 && xhr.status === 200){
            document.querySelector('#time').innerHTML = xhr.responseText;
        }
    }
    xhr.send(); 
}); 
</script>
```
* 코드를 분석해보자

```
var xhr = new XMLHttpRequest();
```
* XMLHttpRequest 객체를 생성한다

```
xhr.open('GET', './time.php');
```
* 접속하려는 대상을 지정한다
  * 첫번째 인자는 form 태그의 method에 대응하는 것으로 GET/POST 방식을 주로 사용
  * 두번째 인자는 접속하고자 하는 서버쪽 리소스의 주소로 form 태그의 action에 해당

```
xhr.onreadystatechange = function(){
    if(xhr.readyState === 4 && xhr.status === 200){
        document.querySelector('#time').innerHTML = xhr.responseText;
    }
}
```
* onreadystatechange 이벤트는 서버와의 통신이 끝났을 때 호출되는 이벤트
* readyState는 통신의 현재 상태를 알려주며 4는 통신이 완료되었음을 의미
* status는 HTTP 통신의 결과를 의미하는데 200은 통신이 성공했음을 의미한다
* responseText 프로퍼티는 서버에서 전송한 데이터를 담고 있다. 이것을 id가 time 엘리먼트의 하위로 삽입   
이를 통해서 현재 서버에서 가져온 현재시간을 페이지 리로딩 없이 가져올 수 있다

# POST 방식
* 아래 예제는 시간대와 시간의 출력 형식을 지정하는 예제
```
<p>time : <span id="time"></span></p>
<select id="timezone">
    <option value="Asia/Seoul">asia/seoul</option>
    <option value="America/New_York">America/New_York</option>
</select>
<select id="format">
    <option value="Y-m-d H:i:s">Y-m-d H:i:s</option>
    <option value="Y-m-d">Y-m-d</option>
</select>
<input type="button" id="execute" value="execute" />
<script>
document.querySelector('input').addEventListener('click', function(event){
    var xhr = new XMLHttpRequest();
    xhr.open('POST', './time2.php');
    xhr.onreadystatechange = function(){
        document.querySelector('#time').innerHTML = xhr.responseText;
    }
    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    var data = '';
    data += 'timezone='+document.getElementById('timezone').value;
    data += '&format='+document.getElementById('format').value;
    xhr.send(data); 
});
</script> 
```
* 중요한 부분을 살펴보자. 데이터 전송방법을 GET에서 POST로 변경
```
xhr.open('POST', './time2.php');
```
* 서버로 전송할 데이터 타입의 형식(MIME)을 지정
```
xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
```
* 서버로 전송할 데이터를 형식에 맞게 만든다. 이름=값&이름=값... 의 형식을 지켜야함

```
var data = '';
data += 'timezone='+document.getElementById('timezone').value;
data += '&format='+document.getElementById('format').value;
```
* send 메소드의 인자로 전송할 데이터를 전달

```
xhr.send(data); 
time2.php
```
* 아래는 Ajax를 이용해서 전송한 데이터를 받아서 현재 시간을 출력해주는 서버쪽 구횬 

```
<?php
$d1 = new DateTime;
$d1->setTimezone(new DateTimezone($_POST['timezone']));
echo $d1->format($_POST['format']);
?>
```
















